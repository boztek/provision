To test this:

drush provision-save @server_master --dns_service_type=bind
drush @server_master provision-zone create foobar.com
drush @server_master provision-zone rr-add foobar.com www A 1.2.3.4

You should end up with a zonefile like:

; Bind zonefile
; File managed by Aegir
; Changes here may be lost by user configurations, tread carefully
$TTL 
@       IN      SOA     foobar.com. hostmaster.foobar.com. ( 2010061700 21600 3600 604800 86400  ) 
www     IN      A       1.2.3.4

this command:

provision-zone create-host www.foobar.com 

should another similar record to the same zonefile.

Bugs:

 1. since the rewrite of the parser, some fields in the SOA are
 missing (retry, refresh, etc) because we lack the context from the
 server (switching to create_config() shoudl fix that)
 2. there's a duplicate serial in PHP storage (patched?)
 3. the internal data structure is confusing and not efficient. here's
 a proposed change:

$zonefile = array('www' => array('a' => array('1.2.3.3', '1.2.3.4')),
                  '@' => array('SOA' => array('hostmaster' => 'localhost', 'email' => 'admin.localhost', 'serial' => '2010082301', 'refresh' => 21600 3600 604800 86400 )'),
                              'A' => array('1.2.3.3'),
                              'MX' => array('mail.localhost'),
                              'NS' => array('localhost', 'ns2.localhost'),
                              )
                 );
  (patched, needs testing and verification)
 4. removing the last record in a zonefile doesn't remove the zone
 5. removing records doesn't work either
 6. we increment the serial in two places, it seems

Caveats:

 1. there's duplicate storage altogether: we could parse zonefiles and
 use that as storage, not PHP files, but that would make switching
 engines more difficult and would require writing parsers for all
 engines.

Todo:

 1. we need slave configuration (ie. modify the slaves configuration
 so that they sync with the master, so just act on create_zone())
 2. for this we need to define the services (ie. the slaves too) in
 the frontend and add NS records when the zonefile is created
 3. we need to hook the zones into the bind configuration (see the
 commented line in create_zone())
 4. we need to reload bind when that is done
